@model VocalSpace.Models.ViewModel.Activity.ActivityInfoViewModel
@{
	ViewData["Title"] = "快來參加" + Model.Title + "!";
}
<div class="page-container container-xxl">
	<div class="col-8 left-container">
		<div class="event-container">
			<!-- 顯示活動封面圖 -->
			<div class="event-cover">
				<img class="event-image" src="@Url.Content(Model.EventCoverPath)" alt="活動圖片">
				<div class="event-date">
					<div class="calende-border-block p-0 text-center">
						<div class="bg-danger text-white font-size-sm T-radius">@Model.EventTime.ToString("MMM")</div>
						<h3 class="mb-1 mt-1 text-black">@Model.EventTime.Day</h3>
						<h6 class="mb-1 mt-1 text-black opacity-50">@Model.EventTime.ToString("dddd")</h6>
					</div>
				</div>
			</div>

			<!-- 活動標題 -->
			<h1 class="event-title mb-4">@Model.Title</h1>

			<!-- 活動資訊 -->
			<div class="event-info">
				<h6 class="text-gray mb-3">
					<span class="bi bi-calendar2-minus"></span>
					@Model.EventTime.ToString("yyyy 年 MM 月 dd 日 | dddd | HH:mm")
				</h6>
				<h6 class="text-gray mb-3">
					<span class="bi bi-geo-alt-fill"></span>
					@Model.City．@Model.Location
				</h6>
			</div>
			<hr class="mt-5 mb-2">

			<!-- 上傳者資訊 -->
			<div class="poster-section">
				@await Html.PartialAsync("_UserbarContainer_partial", Model.UploaderId)
			</div>
			<hr class="mt-2 mb-5">

			<!-- 活動介紹 -->
			<h2>介紹</h2>
			<div class="introduce-area pt-2 pb-2">
				<div class="introduce">
					<p>
						@(string.IsNullOrWhiteSpace(Model.ActivityDescription) ? "此活動沒有任何介紹!" : Html.Raw(Model.ActivityDescription.Replace("\\n", "<br>")))
					</p>
				</div>
			</div>
			<hr class="mt-5 mb-5">
			<!-- 留言串partialview放這裡 -->
			<div id="comment-section"
				 data-target-id="@Model.ActivityId"
				 data-target-type="Activity">

				<!-- 顯示留言輸入區 (不會被 AJAX 更新) -->
				@await Html.PartialAsync("_CommentInput", Model.CommentSection)

				<!-- 顯示留言清單 (會被 AJAX 更新) -->
				<div id="comment-list-container">
					<p>留言載入中...</p> <!-- AJAX 載入時顯示_CommentList趴秀 -->
				</div>
			</div>
		</div>
	</div>
	<div class="col-4 right-container">
		<div class="activity-info">
			<h3>73 人想去</h3>
			<div class="activity-buttons">
				<button class="btn interested-btn" id="btn-interested" data-activity-id="@Model.ActivityId">★ 我也想去！</button>
				<button class="btn calendar-btn">📅 加入行事曆</button>
			</div>
		</div>
	</div>
</div>
@* 直接加载 Modal，并设为隐藏 *@
@* @await Html.PartialAsync("_Modal_ShereActivity") *@

@section Scripts {
	<script src="~/js/Comment.js" asp-append-version="true"></script>
	<script>
		//AJAX 取得UserBar
				$(function () {
					let userId = $("#userBarContainer").data("userid");
					$.ajax({
						url: `/Personal/GetUserBar/${userId}`, // Controller 端點，
						type: "GET",
						success: function (partialView) {
							$("#userBarContainer").html(partialView);
						},
						error: function (xhr) {
							$("#userBarContainer").html(`<p class='error-message'>上傳者載入失敗，錯誤訊息${xhr.responseText}</p>`);
						}
					});
				});

		// 		let interestedCount = 73;

		// 		function handleInterested() {
		// 		if (!isLogin) {
		// 			// 如果未登入，導向登入頁
		// 			window.location.href = "/Accounts/Login";
		// 			return;
		// 		}

		// 			interestedCount++;
		// 			document.querySelector(".activity-info h3").innerText = `${interestedCount} 人想去`;
		// 			var myModal = new bootstrap.Modal(document.getElementById('shareModal'));
		// 			myModal.show();
		// 		}
		// 		function addToCalendar() {
		// 			window.open("https://calendar.google.com/calendar/r/eventedit", "_blank");
		// 		}
		// 	</script>
 }