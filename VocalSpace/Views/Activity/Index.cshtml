@{
}
@* 活動總覽 *@
<div class="page-container">

	<div class="container pt-4 mb-4">
		<div class="nav nav-pills mb-6 gap-lg-5 ">
			<a href="#" class="nav-link active">所有活動</a>
			<a href="#" class="nav-link">我的活動</a>
		</div>
		<hr>

		@*輪播圖*@
		<div id="carouselExample" class="carousel slide container mb-4" data-bs-ride="carousel">
			<div class="carousel-inner">
				<div class="carousel-item active">
					<div class="d-flex">
						<div class="col-6">
							<div class="actpic-container">
								<img src="/image/Activity/cs.jpg" alt="活動封面">
							</div>
						</div>
						<div class="col-6">
							<div class="carousel-textarea">
								<div class="row row-xs align-items-center">
									<div class="col-2">
										<div class="calende-border-block p-0 text-center">
											<div class="bg-danger text-white font-size-sm">3 月</div>
											<h3 class="mb-1 mt-1 text-black">7</h3>
										</div>
									</div>
									<div class="col-10">
										<a><h2 class="text-maxone">THE CHAINSMOKERS LIVE IN TAIPEI 2025</h2></a>
									</div>
								</div>
								<hr>
								<p>17:00．臺北市．大佳河濱公園</p>
								<div class="text-maxthree">
									<p>
										THE CHAINSMOKERS 主場震撼登場！
										全球最受矚目的音樂雙人組合 The Chainsmokers
										即將帶來一場震撼音樂盛會！這場音樂盛會必定讓您嗨翻全場！
									</p>
								</div>
								<span>The Chainsmokers</span>
							</div>
						</div>
					</div>
				</div>
				<div class="carousel-item">
					<div class="d-flex">
						<div class="col-6">
							<div class="actpic-container">
								<img src="/image/Activity/sandwich.jpg" alt="活動封面">
							</div>
						</div>
						<div class="col-6">
							<div class="carousel-textarea">
								<div class="row row-xs align-items-center">
									<div class="col-2">
										<div class="calende-border-block p-0 text-center">
											<div class="bg-danger text-white font-size-sm">3 月</div>
											<h3 class="mb-1 mt-1 text-black">22</h3>
										</div>
									</div>
									<div class="col-10">
										<h2 class="text-maxone">打倒三明治《人生曬百味》</h2>
									</div>
								</div>
								<hr>
								<p>19:30．台北市．傳音樂展演空間</p>
								<div class="text-maxthree">
									<p>
										象熱的心已把自己燃成灰，並糾結成一團圈的霧朦；
										揉過所有顛簸的痕跡，猛然會發現空氣變得新鮮。
									</p>
								</div>
								<span>打倒三明治</span>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- 導航按鈕 -->
			<button class="carousel-control-prev  " type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
				<span class="carousel-control-prev-icon sync-data-theme border rounded-circle " aria-hidden="true"></span>
				<span class="visually-hidden">Previous</span>
			</button>
			<button class="carousel-control-next  " type="button" data-bs-target="#carouselExample " data-bs-slide="next">
				<span class="carousel-control-next-icon sync-data-theme border rounded-circle " aria-hidden="true"></span>
				<span class="visually-hidden">Next</span>
			</button>
		</div>
	</div>
	<!-- 下方 -->
	<div class="container d-flex flex-row pt-4">
		<!-- 左側篩選區域 -->
		<div class="col-3 filter-sidebar">
			<!-- 搜尋輸入框 -->
			<div class="mb-3 border-block">
				<input type="text" class="form-control" placeholder="關鍵字">
				<hr class="mt-5 mb-5">
				<!-- 地區 -->
				<h5 class="mb-4">地區</h5>
				<div class="d-flex flex-wrap gap-3 ">
					<button type="button" class="btn btn-outline-danger btn-toggle buttoncircle active">全部</button>
					<button type="button" class="btn btn-outline-danger btn-toggle buttoncircle">北部</button>
					<button type="button" class="btn btn-outline-danger btn-toggle buttoncircle">中部</button>
					<button type="button" class="btn btn-outline-danger btn-toggle buttoncircle">南部</button>
					<button type="button" class="btn btn-outline-danger btn-toggle buttoncircle">東部</button>
					<button type="button" class="btn btn-outline-danger btn-toggle buttoncircle">外島</button>
					<button type="button" class="btn btn-outline-danger btn-toggle buttoncircle">其他</button>
				</div>
				<hr class="mt-5 mb-5">
				<!-- 日期 -->
				<h5 class="mt-3">日期</h5>
				<select class="form-select" id="dateSelect">
					<option selected>近期活動</option>
					<option value="1">14天內</option>
					<option value="2">這個月</option>
					<option value="3">下個月</option>
					<option value="4">選擇日期</option>
				</select>
			</div>
		</div>
		<!-- 右側活動列表 -->
		<div class="col-9">
			<div class="row align-items-center mb-4">
				<div class="container">
					<h2 id="activityListTitle">活動列表</h2>
					<!-- 活動列表partialview -->
					@await Html.PartialAsync("_ActivityList_partialview")
				</div>
			</div>
		</div>
	</div>
</div>

<!-- 日期篩選 Modal -->
<div class="modal fade" id="datePickerModal" tabindex="-1" aria-labelledby="datePickerModalLabel" aria-hidden="false">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="datePickerModalLabel">選擇日期區間</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<label>開始日期</label>
				<input type="date" id="startDatePicker" class="form-control mb-3">
				<label>結束日期</label>
				<input type="date" id="endDatePicker" class="form-control">
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
				<button type="button" class="btn btn-danger" id="confirmDateRange">確定篩選</button>
			</div>
		</div>
	</div>
</div>


@section Scripts {
	<script>
		// 讓點擊「地區」按鈕時可以切換 active 狀態
		const btnToggles = document.querySelectorAll('.btn-toggle');
		btnToggles.forEach(btn => {
			btn.addEventListener('click', () => {
				// 先移除所有按鈕的 active，再為當前點擊的按鈕加上 active
				btnToggles.forEach(b => b.classList.remove('active'));
				btn.classList.add('active');
			});
		});

				// 所有活動與我的活動 active 狀態
		const navlk = document.querySelectorAll('.nav-link');
		navlk.forEach(nav => {
			nav.addEventListener('click', () => {
				// 先移除所有按鈕的 active，再為當前點擊的按鈕加上 active
				navlk.forEach(n => n.classList.remove('active'));
				nav.classList.add('active');
			});
		});
					// 更新活動列表標題
		let dateModal; // 提升全域變數

		document.addEventListener("DOMContentLoaded", function () {
			const dateSelect = document.getElementById("dateSelect");
			const activityListTitle = document.getElementById("activityListTitle");
			dateModal = new bootstrap.Modal(document.getElementById("datePickerModal")); // 只初始化一次

			// 日期變更事件
			dateSelect.addEventListener("change", function () {
				const today = new Date();
				let startDate = "";
				let endDate = "";

				switch (dateSelect.value) {
					case "1": // 14天內
						startDate = formatDate(today);
						endDate = formatDate(addDays(today, 14));
						updateTitle(startDate, endDate);
						break;
					case "2": // 這個月
						startDate = formatDate(new Date(today.getFullYear(), today.getMonth(), 1));
						endDate = formatDate(new Date(today.getFullYear(), today.getMonth() + 1, 0));
						updateTitle(startDate, endDate);
						break;
					case "3": // 下個月
						startDate = formatDate(new Date(today.getFullYear(), today.getMonth() + 1, 1));
						endDate = formatDate(new Date(today.getFullYear(), today.getMonth() + 2, 0));
						updateTitle(startDate, endDate);
						break;
					case "4": // 選擇日期
						dateModal.show(); // 直接顯示 Modal
						return; // 提早結束，避免 updateTitle
					default:
						activityListTitle.innerText = "活動列表";
						return;
				}
				updateTitle(startDate, endDate);
			});

			// 日期格式化 yyyy-MM-dd
			function formatDate(date) {
				const year = date.getFullYear();
				const month = String(date.getMonth() + 1).padStart(2, "0");
				const day = String(date.getDate()).padStart(2, "0");
				return `${year}-${month}-${day}`;
			}

			// 增加天數
			function addDays(date, days) {
				const result = new Date(date);
				result.setDate(result.getDate() + days);
				return result;
			}
		});

		document.getElementById("confirmDateRange").addEventListener("click", function () {
			const startDate = document.getElementById("startDatePicker").value;
			const endDate = document.getElementById("endDatePicker").value;

			if (startDate && endDate) {
				updateTitle(startDate, endDate);
				dateModal.hide(); // 關閉 Modal
			} else {
				alert("請選擇完整的日期區間！");
			}
		});

		// 更新標題
		function updateTitle(start, end) {
			const activityListTitle = document.getElementById("activityListTitle");
			activityListTitle.innerText = `活動列表：${start} ~ ${end}`;
		}

		//輪播圖 封面模糊效果
				document.querySelectorAll('.actpic-container').forEach(container => {
			const img = container.querySelector('img');
			if (img) {
				container.style.setProperty('--cover-url', `url(${img.src})`);
			}
		});
	</script>
}
