@model VocalSpace.Models.ViewModel.Selection.SelectionListViewModel
@{
	var errorMessage = TempData["ErrorMessage"] as string;
}

@if (!string.IsNullOrEmpty(errorMessage))
{
	<script>
		alert("@errorMessage"); // 顯示錯誤訊息
		window.location.href = '@Url.Action("Index", "Selection")'; // 跳轉回首頁
	</script>
}
<section class="banner">
	<div class="banner__left">
		<img class="banner__left-img" src="@Url.Content("~/image/selection/bannerLightning.png")" />
		<button class="btn btn-submit--theme banner__left-btn" onclick="window.location.href='/selection/Index'">前往徵選</button>
	</div>
	<div class="banner__right">
		<img class="banner__right-img" src="@Url.Content("~/image/selection/bannerContent.png")" />

	</div>
</section>

<section class="content ">

	<div class="content__header">
		<div class="content__header-title">
			<h1>@(Model.Title) </h1>
			<br />
			<p>徵選截止日:@(Model.EndDate) </p>
			<p>
				徵選狀態: <span style="color:@(Model.JoinState == "開放中" ? "red" : "gray")">@(Model.JoinState)</span>
			</p>
			<p>
				投票狀態: <span style="color:@(Model.VoteState == "開放中" ? "red" : "gray")">@(Model.VoteState)</span>
			</p>
			@if (Model.JoinState == "開放中")
			{
				<a href="/selection/Apply/@(Model.SelectionId)" class="btn btn-submit--theme">我要報名</a>
			}
		</div>
		<div class="content__header-aside">
			@if (ViewBag.section != null && ViewBag.section.ToString() == "EventDescription")
			{
				<div class="content-section works">
					<img src="/image//selection//voteAD.png" />
				</div>
			}
			@if (ViewBag.section != null && ViewBag.section.ToString() == "Works")
			{
				<div class="content-section descrition">
					<h5>徵選活動日程</h5>
					<p>@(Model.StartDate) 開始</p>
					<p>@(Model.EndDate) 結束</p>
					<button class="btn btn-submit--theme googleAdd">加入google行事曆</button>
				</div>
			}
		</div>
	</div>
	<div class="content__menu  border-bottom">
		<ul>
			<li class="content__menu-item" data-target=".descrition" id="showDescription">
				<a href="/selection/EventDescription/@(Model.SelectionId)">
					活動說明
				</a>
			</li>
			<li class="content__menu-item" data-target=".works" id="showWorks">
				<a href="/selection/GetWorks/@(Model.SelectionId)">
					參加作品
				</a>
			</li>
		</ul>
	</div>
	<div class="content__card-area">
		@if (ViewBag.section != null && ViewBag.section.ToString() == "EventDescription")
		{
			<div class="content-section descrition" id="descriptionSection">
				<p>活動說明</p><br /><br />
				<span>@(Model.Description)</span>
			</div>
		}
		@if (ViewBag.section != null && ViewBag.section.ToString() == "Works")
		{
			<div class="content-section works" id="worksSection">
				<h3 class="fw-bold">所有參加作品數: @(Model.Songs.Count) 筆</h3>
				<div id="worksContent">
					<!-- 這裡顯示作品區塊的內容 -->
					@{
						await Html.RenderPartialAsync("_CardPartial", Model.Songs);
					}
				</div>
				@if (Model.Songs.Count >= 1)
				{
					<div aria-label="Page navigation example">
						<ul class="pagination">
							<li class="page-item page-pre_navigation" data-selectionid="@(Model.SelectionId)">
								<a class="page-link" aria-label="Previous">
									<span aria-hidden="true">&laquo;</span>
								</a>
							</li>
							@for (var i = 1; i <= Model.PaginationCount; i++)
							{
								<li class="page-item page-item_navigation" data-selectionid="@(Model.SelectionId)" data-currentpage="@(i)"><a class="page-link">@(i)</a></li>
							}
							<li class="page-item page-next_navigation" data-selectionid="@(Model.SelectionId)" data-paginationCount="@(Model.PaginationCount)">
								<a class="page-link" aria-label="Next">
									<span aria-hidden="true">&raquo;</span>
								</a>
							</li>
						</ul>
					</div>
				}
			</div>
		}
	</div>
</section>
<script src="~/lib/jquery/dist/jquery.min.js"></script>
@section Scripts {
	<script>
		$(document).ready(function() {
			let currentPage = 1;
			let selectionId;
			let paginationCount;
			//上一頁
			$(".page-pre_navigation").on("click",function(){
				selectionId = $(this).attr("data-selectionid");
				currentPage = currentPage <=1 ? currentPage=1 : currentPage-1;

				 // 發送 AJAX 請求
				$.ajax({
					url: `/Selection/GetWorks/${selectionId}/${currentPage}`,
					type: 'GET',  // Razor Page 通常使用 GET 來獲取數據
					success: function(response) {
						 $("#worksContent").html(response);  // 更新內容
					},
					error: function(xhr, status, error) {
						alert("請求失敗，請稍後再試。"+error);
					}
				});
			});
			//下一頁
			$(".page-next_navigation").on("click",function(){
				   selectionId = $(this).attr("data-selectionid");
				   paginationCount = $(this).attr("data-paginationCount");


				console.log(currentPage);
				console.log(paginationCount);
				currentPage = currentPage >= paginationCount ? currentPage : currentPage + 1;
				console.log(currentPage);
				// 發送 AJAX 請求
				$.ajax({
					url: `/Selection/GetWorks/${selectionId}/${currentPage}`,
					type: 'GET',  // Razor Page 通常使用 GET 來獲取數據
					success: function(response) {
						console.log("A");
						 $("#worksContent").html(response);  // 更新內容
						// console.log(response);
					},
					error: function(xhr, status, error) {
						alert("請求失敗，請稍後再試。"+error);
					}
				});

					});

			//點選頁數
			$(".page-item_navigation").on("click", function() {
				 selectionId = $(this).attr("data-selectionid");
				 paginationCount = $(this).attr("data-currentpage");

				// 發送 AJAX 請求
				$.ajax({
					url: `/Selection/GetWorks/${selectionId}/${currentPage}`,
					type: 'GET',  // Razor Page 通常使用 GET 來獲取數據
					success: function(response) {
						console.log("A");
						 $("#worksContent").html(response);  // 更新內容
						// console.log(response);
					},
					error: function(xhr, status, error) {
						alert("請求失敗，請稍後再試。"+error);
					}
				});
			});
		});

	</script>
}

